<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŒŠ Ocean-Themed Water Quality Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #003366, #005f99);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #e0f7fa;
      margin: 0;
      padding: 0;
    }
    h1 {
      text-align: center;
      padding: 20px;
      background: rgba(0, 102, 153, 0.8);
      margin: 0;
      font-size: 2rem;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background-color: rgba(0, 51, 102, 0.6);
      padding: 10px 0;
    }
    .tab {
      background: #007acc;
      border: none;
      padding: 10px 20px;
      margin: 0 5px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 5px;
    }
    .tab:hover {
      background: #005f99;
    }
    .tab.active {
      background: #003f5c;
    }
    .chart-container {
      max-width: 1000px;
      margin: 20px auto;
      display: none;
    }
    .chart-container.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1>ðŸŒŠ Real-Time Ocean-Themed Water Quality Dashboard</h1>
  <div class="tabs">
    <button class="tab active" data-chart="ph">pH</button>
    <button class="tab" data-chart="do">Dissolved Oxygen</button>
    <button class="tab" data-chart="salinity">Salinity</button>
    <button class="tab" data-chart="ammonium">Ammonium</button>
    <button class="tab" data-chart="chlorophyll">Chlorophyll</button>
  </div>
  <div id="ph" class="chart-container active"><div id="phChart"></div></div>
  <div id="do" class="chart-container"><div id="doChart"></div></div>
  <div id="salinity" class="chart-container"><div id="salinityChart"></div></div>
  <div id="ammonium" class="chart-container"><div id="ammoniumChart"></div></div>
  <div id="chlorophyll" class="chart-container"><div id="chlorophyllChart"></div></div>

  <script>
    const fetchData = async () => {
      const res = await fetch('/api/history');
      const data = await res.json();
      return data.map(d => ({
        t: new Date(d.timestamp),
        ph: d.ph,
        do: d.dissolved_oxygen,
        salinity: d.salinity,
        ammonium: d.ammonium,
        chlorophyll: d.chlorophyll
      }));
    };

    const createChart = async (chartId, label, field, color) => {
      const data = await fetchData();
      Plotly.newPlot(chartId, [{
        x: data.map(d => d.t),
        y: data.map(d => d[field]),
        type: 'scatter',
        mode: 'lines',
        name: label,
        line: { color: color, width: 2 }
      }], {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#e0f7fa' },
        xaxis: { title: 'Time' },
        yaxis: { title: label },
        margin: { t: 20, b: 50 }
      });
    };

    createChart("phChart", "pH", "ph", "#ffb74d");
    createChart("doChart", "Dissolved Oxygen (mg/L)", "do", "#4dd0e1");
    createChart("salinityChart", "Salinity (ppt)", "salinity", "#81c784");
    createChart("ammoniumChart", "Ammonium (mg/L)", "ammonium", "#e57373");
    createChart("chlorophyllChart", "Chlorophyll (Î¼g/L)", "chlorophyll", "#ba68c8");

    // Tab switching
    const tabs = document.querySelectorAll('.tab');
    const charts = document.querySelectorAll('.chart-container');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const chartToShow = tab.dataset.chart;
        charts.forEach(chart => {
          chart.classList.remove('active');
          if (chart.id === chartToShow) {
            chart.classList.add('active');
          }
        });
      });
    });
  </script>
</body>
</html>
